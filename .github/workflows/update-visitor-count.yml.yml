name: Update Visitor Count Badge

on:
  schedule:
    - cron: '0 * * * *' # a cada hora
  workflow_dispatch:

jobs:
  update-visitor-count:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Get visitor count from CountAPI and set output
      run: |
        response=$(curl -s https://api.countapi.xyz/hit/Vuenar.github.io/visits)
        echo "Response: $response"
        count=$(echo $response | jq '.value')
        echo "VISIT_COUNT=$count" >> $GITHUB_ENV

    - name: Update SVG file
      run: |
        echo "Updating SVG with count: $VISIT_COUNT"
        cat > ./assets/visitors.svg <<EOF
<svg xmlns="http://www.w3.org/2000/svg" width="160" height="32">
  <rect width="160" height="32" fill="#0d1117" rx="6" />
  <text x="10" y="21" fill="#c9d1d9" font-size="14" font-family="Segoe UI, sans-serif">ğŸ‘ï¸ Visitantes:</text>
  <text x="120" y="21" fill="#58a6ff" font-size="14" font-family="Segoe UI, sans-serif">${VISIT_COUNT}</text>
</svg>
EOF

    - name: Commit and push SVG update
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add ./assets/visitors.svg
        git diff --quiet && echo "No changes to commit" || git commit -m "Update visitor count badge [skip ci]"
        git push
